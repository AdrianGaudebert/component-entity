!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):t.ensy=n()}(this,function(){"use strict";function t(n){if(null==n||"object"!=("undefined"==typeof n?"undefined":e(n)))return n;var o;if(n instanceof Date)return o=new Date,o.setTime(n.getTime()),o;if(n instanceof Array){o=[];for(var r=0,i=n.length;r<i;r++)o[r]=t(n[r]);return o}if(n instanceof Object){o={};for(var s in n)n.hasOwnProperty(s)&&(o[s]=t(n[s]));return o}}function n(t){return t&&"[object Function]"==={}.toString.call(t)}var e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},o=(function(){function t(t){this.value=t}function n(n){function e(t,n){return new Promise(function(e,r){var a={key:t,arg:n,resolve:e,reject:r,next:null};s?s=s.next=a:(i=s=a,o(t,n))})}function o(e,i){try{var s=n[e](i),a=s.value;a instanceof t?Promise.resolve(a.value).then(function(t){o("next",t)},function(t){o("throw",t)}):r(s.done?"return":"normal",s.value)}catch(t){r("throw",t)}}function r(t,n){switch(t){case"return":i.resolve({value:n,done:!0});break;case"throw":i.reject(n);break;default:i.resolve({value:n,done:!1})}i=i.next,i?o(i.key,i.arg):s=null}var i,s;this._invoke=e,"function"!=typeof n.return&&(this.return=void 0)}return"function"==typeof Symbol&&Symbol.asyncIterator&&(n.prototype[Symbol.asyncIterator]=function(){return this}),n.prototype.next=function(t){return this._invoke("next",t)},n.prototype.throw=function(t){return this._invoke("throw",t)},n.prototype.return=function(t){return this._invoke("return",t)},{wrap:function(t){return function(){return new n(t.apply(this,arguments))}},await:function(n){return new t(n)}}}(),function(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}),r=function(){function t(t,n){for(var e=0;e<n.length;e++){var o=n[e];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}return function(n,e,o){return e&&t(n.prototype,e),o&&t(n,o),n}}(),i=function(){function e(t){o(this,e),this.listener=null,t&&n(t.emit)&&(this.listener=t),this.entities=[],this.components={},this.assemblages={},this.entityComponentData={},this.processors=[],this.uid=0}return r(e,[{key:"getUid",value:function(){return this.uid++}},{key:"createEntity",value:function(t){var n=this.getUid();return this.addComponentsToEntity(t,n),this.entities.push(n),n}},{key:"removeEntity",value:function(t){for(var n in this.entityComponentData)this.entityComponentData.hasOwnProperty(n)&&this.entityComponentData[n][t]&&delete this.entityComponentData[n][t];return this.entities.splice(this.entities.indexOf(t),1),this}},{key:"addComponent",value:function(t,n){return this.components[t]=n,this}},{key:"removeComponent",value:function(t){return delete this.components[t],delete this.entityComponentData[t],this}},{key:"getComponentsList",value:function(){return Object.keys(this.components)}},{key:"addComponentsToEntity",value:function(n,e){var o,r,i=this;for(o=n.length-1;o>=0;o--)if(r=n[o],!this.components[r])throw new Error("Trying to use unknown component: "+r);for(o=n.length-1;o>=0;o--){r=n[o],this.entityComponentData[r]||(this.entityComponentData[r]={});var s=null;i.listener?(s={},function(n){var o=t(i.components[r].state);for(var s in o)o.hasOwnProperty(s)&&!function(t){Object.defineProperty(n,t,{get:function(){return o[t]},set:function(n){o[t]=n,i.listener.emit("entityComponentUpdated",e,r)}})}(s)}(s)):s=t(i.components[r].state),s.__id=e,this.entityComponentData[r][e]=s}return this}},{key:"removeComponentsFromEntity",value:function(t,n){var e,o;for(e=t.length-1;e>=0;e--)if(o=t[e],!this.components[o])throw new Error("Trying to use unknown component: "+o);for(e=t.length-1;e>=0;e--)o=t[e],this.entityComponentData[o]&&this.entityComponentData[o][n]&&delete this.entityComponentData[o][n];return this}},{key:"getComponentDataForEntity",value:function(t,n){if(!(t in this.components))throw new Error("Trying to use unknown component: "+t);if(!this.entityComponentData.hasOwnProperty(t)||!this.entityComponentData[t].hasOwnProperty(n))throw new Error("No data for component "+t+" and entity "+n);return this.entityComponentData[t][n]}},{key:"updateComponentDataForEntity",value:function(t,n,e){var o=this.getComponentDataForEntity(t,n);for(var r in e)e.hasOwnProperty(r)&&o.hasOwnProperty(r)&&(o[r]=e[r]);return this}},{key:"getComponentsData",value:function(t){if(!(t in this.components))throw new Error("Trying to use unknown component: "+t);return this.entityComponentData.hasOwnProperty(t)?this.entityComponentData[t]:[]}},{key:"entityHasComponent",value:function(t,n){return n in this.components&&(this.entityComponentData.hasOwnProperty(n)&&this.entityComponentData[n].hasOwnProperty(t))}},{key:"addAssemblage",value:function(t,n){return this.assemblages[t]=n,this}},{key:"removeAssemblage",value:function(t){return delete this.assemblages[t],this}},{key:"createEntityFromAssemblage",value:function(t){if(!(t in this.assemblages))throw new Error("Trying to use unknown assemblage: "+t);var n=this.assemblages[t],e=this.createEntity(n.components);for(var o in n.initialState)if(n.initialState.hasOwnProperty(o)){var r=n.initialState[o];this.updateComponentDataForEntity(o,e,r)}return e}},{key:"addProcessor",value:function(t){return this.processors.push(t),this}},{key:"removeProcessor",value:function(t){return this.processors.splice(this.processors.indexOf(t),1),this}},{key:"update",value:function(t){for(var n=0;n<this.processors.length;n++)this.processors[n].update(t);return this}}]),e}();return i});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjpudWxsLCJzb3VyY2VzIjpbInNyYy9lbnRpdHktbWFuYWdlci5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKiFcbiAqIGVuc3kgLSBFbnRpdHkgU3lzdGVtIEphdmFTY3JpcHQgTGlicmFyeSB2MS4yLjFcbiAqXG4gKiBBIEphdmFTY3JpcHQgaW1wbGVtZW50YXRpb24gb2YgdGhlIEVudGl0eSBTeXN0ZW0gbW9kZWwgYXMgZGVzY3JpYmVkIGJ5XG4gKiBBZGFtIE1hcnRpbiBpbiBodHRwOi8vdC1tYWNoaW5lLm9yZy9pbmRleC5waHAvMjAwOS8xMC8yNi9lbnRpdHktc3lzdGVtcy1hcmUtdGhlLWZ1dHVyZS1vZi1tbW9zLXBhcnQtNS9cbiAqXG4gKiBAYXV0aG9yIEFkcmlhbiBHYXVkZWJlcnQgLSBhZHJpYW5AZ2F1ZGViZXJ0LmZyXG4gKiBAbGljZW5zZSBNSVQgbGljZW5zZS5cbiAqXG4gKi9cblxuLyohXG4gKiBSZXR1cm4gYSBjbG9uZSBvZiBhbiBvYmplY3QuXG4gKiBGcm9tIGh0dHBzOi8vc3RhY2tvdmVyZmxvdy5jb20vcXVlc3Rpb25zLzcyODM2MFxuICovXG5mdW5jdGlvbiBjbG9uZShvYmopIHtcbiAgICAvLyBIYW5kbGUgdGhlIDMgc2ltcGxlIHR5cGVzLCBhbmQgbnVsbCBvciB1bmRlZmluZWRcbiAgICBpZiAobnVsbCA9PSBvYmogfHwgJ29iamVjdCcgIT0gdHlwZW9mIG9iaikgcmV0dXJuIG9iajtcblxuICAgIHZhciBjb3B5O1xuXG4gICAgLy8gSGFuZGxlIERhdGVcbiAgICBpZiAob2JqIGluc3RhbmNlb2YgRGF0ZSkge1xuICAgICAgICBjb3B5ID0gbmV3IERhdGUoKTtcbiAgICAgICAgY29weS5zZXRUaW1lKG9iai5nZXRUaW1lKCkpO1xuICAgICAgICByZXR1cm4gY29weTtcbiAgICB9XG5cbiAgICAvLyBIYW5kbGUgQXJyYXlcbiAgICBpZiAob2JqIGluc3RhbmNlb2YgQXJyYXkpIHtcbiAgICAgICAgY29weSA9IFtdO1xuICAgICAgICBmb3IgKHZhciBpID0gMCwgbGVuID0gb2JqLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7XG4gICAgICAgICAgICBjb3B5W2ldID0gY2xvbmUob2JqW2ldKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gY29weTtcbiAgICB9XG5cbiAgICAvLyBIYW5kbGUgT2JqZWN0XG4gICAgaWYgKG9iaiBpbnN0YW5jZW9mIE9iamVjdCkge1xuICAgICAgICBjb3B5ID0ge307XG4gICAgICAgIGZvciAodmFyIGF0dHIgaW4gb2JqKSB7XG4gICAgICAgICAgICBpZiAob2JqLmhhc093blByb3BlcnR5KGF0dHIpKSBjb3B5W2F0dHJdID0gY2xvbmUob2JqW2F0dHJdKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gY29weTtcbiAgICB9XG59XG5cbi8qIVxuICogUmV0dXJuIHRydWUgaWYgdGhlIHBhcmFtZXRlciBpcyBhIGZ1bmN0aW9uLlxuICogRnJvbSBodHRwczovL3N0YWNrb3ZlcmZsb3cuY29tL3F1ZXN0aW9ucy81OTk5OTk4XG4gKi9cbmZ1bmN0aW9uIGlzRnVuY3Rpb24odGhpbmdUb0NoZWNrKSB7XG4gICAgcmV0dXJuIHRoaW5nVG9DaGVjayAmJiAoe30pLnRvU3RyaW5nLmNhbGwodGhpbmdUb0NoZWNrKSA9PT0gJ1tvYmplY3QgRnVuY3Rpb25dJztcbn1cblxuLyoqXG4gKiBAY2xhc3MgRW50aXR5TWFuYWdlclxuICpcbiAqIEltcGxlbWVudCB0aGUgRW50aXR5IFN5c3RlbSBtb2RlbCBhbmQgcHJvdmlkZSB0b29scyB0byBlYXNpbHlcbiAqIGNyZWF0ZSBhbmQgbWFuaXB1bGF0ZSBFbnRpdGllcywgQ29tcG9uZW50cyBhbmQgUHJvY2Vzc29ycy5cbiAqL1xuY2xhc3MgRW50aXR5TWFuYWdlciB7XG4gICAgY29uc3RydWN0b3IobGlzdGVuZXIpIHtcbiAgICAgICAgdGhpcy5saXN0ZW5lciA9IG51bGw7XG4gICAgICAgIGlmIChsaXN0ZW5lciAmJiBpc0Z1bmN0aW9uKGxpc3RlbmVyLmVtaXQpKSB7XG4gICAgICAgICAgICB0aGlzLmxpc3RlbmVyID0gbGlzdGVuZXI7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBBIGxpc3Qgb2YgZW50aXR5IElEcywgZWFjaCBiZWluZyBhIHNpbXBsZSBpbnRlZ2VyLlxuICAgICAgICB0aGlzLmVudGl0aWVzID0gW107XG5cbiAgICAgICAgLy8gQSBkaWN0aW9uYXJ5IG9mIGNvbXBvbmVudHMsIHdoZXJlIGtleXMgYXJlIHRoZSBuYW1lIG9mIGVhY2hcbiAgICAgICAgLy8gY29tcG9uZW50LiBDb21wb25lbnRzIGFyZSBvYmplY3RzIGNvbnRhaW5pbmc6XG4gICAgICAgIC8vICAqIG1ldGFkYXRhIChuYW1lLCBkZXNjcmlwdGlvbilcbiAgICAgICAgLy8gICogdGhlIGluaXRpYWwgc2V0IG9mIGRhdGEgdGhhdCBkZWZpbmVzIHRoZSBkZWZhdWx0IHN0YXRlIG9mIGFcbiAgICAgICAgLy8gICAgbmV3bHkgaW5zdGFuY2lhdGVkIGNvbXBvbmVudFxuICAgICAgICB0aGlzLmNvbXBvbmVudHMgPSB7fTtcblxuICAgICAgICAvLyBBIGRpY3Rpb25hcnkgb2YgYXNzZW1ibGFnZXMsIHdoZXJlIGtleXMgYXJlIHRoZSBuYW1lIG9mIGVhY2hcbiAgICAgICAgLy8gYXNzZW1ibGFnZS4gQXNzZW1ibGFnZXMgYXJlIG9iamVjdHMgY29udGFpbmluZzpcbiAgICAgICAgLy8gICogbWV0YWRhdGEgKG5hbWUsIGRlc2NyaXB0aW9uKVxuICAgICAgICAvLyAgKiBhIGxpc3Qgb2YgY29tcG9uZW50cyB0byBhZGQgdG8gdGhlIGVudGl0eVxuICAgICAgICAvLyAgKiBhbiBpbml0aWFsIHN0YXRlIGZvciBzb21lIGNvbXBvbmVudHMsIHRvIG92ZXJyaWRlIHRoZSBkZWZhdWx0c1xuICAgICAgICB0aGlzLmFzc2VtYmxhZ2VzID0ge307XG5cbiAgICAgICAgLyohXG4gICAgICAgICAqIEEgcmVsYXRpb25hbC1saWtlIGxpc3Qgb2YgZW50aXR5IHN0YXRlcy4gVGhlcmUgaXMgb25lIGxpbmUgZm9yXG4gICAgICAgICAqIGVhY2ggZW50aXR5IC0gY29tcG9uZW50IGFzc29jaWF0aW9uLlxuICAgICAgICAgKlxuICAgICAgICAgKiBUbyBvcHRpbWl6ZSB0aGUgYWNjZXNzIHRpbWUgdG8gdGhpcyBkYXRhLCBpdCBpcyBzdG9yZWQgaW4gYVxuICAgICAgICAgKiBkaWN0aW9uYXJ5IG9mIGRpY3Rpb25hcmllcyBvZiB0aGlzIGZvcm06XG4gICAgICAgICAqIHtcbiAgICAgICAgICogICBcImNvbXBvbmVudElkXCI6IHtcbiAgICAgICAgICogICAgIFwiZW50aXR5SWRcIjoge1xuICAgICAgICAgKiAgICAgICAuLi5cbiAgICAgICAgICogICAgICAgaGVyZSBjb21lcyB0aGUgc3RhdGUgb2YgdGhpcyBlbnRpdHkgZm9yIHRoaXMgY29tcG9uZW50XG4gICAgICAgICAqICAgICAgIC4uLlxuICAgICAgICAgKiAgICAgfVxuICAgICAgICAgKiAgIH1cbiAgICAgICAgICogfVxuICAgICAgICAgKlxuICAgICAgICAgKiBUaGlzIHdheSwgZ2V0dGluZyB0aGUgZGF0YSBvZiBvbmUgZW50aXR5IGZvciBvbmUgY29tcG9uZW50IGlzOlxuICAgICAgICAgKiAgIHRoaXMuZW50aXR5Q29tcG9uZW50RGF0YVtjb21wb25lbnRJZF1bZW50aXR5SWRdXG4gICAgICAgICAqIGFuZCBnZXR0aW5nIGFsbCBlbnRpdGllcyBmb3Igb25lIGNvbXBvbmVudCBpczpcbiAgICAgICAgICogICB0aGlzLmVudGl0eUNvbXBvbmVudERhdGFbY29tcG9uZW50SWRdXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmVudGl0eUNvbXBvbmVudERhdGEgPSB7fTtcblxuICAgICAgICAvLyBUaGUgb3JkZXJlZCBsaXN0IG9mIHByb2Nlc3NvcnMga25vd24gYnkgdGhpcyBtYW5hZ2VyLlxuICAgICAgICB0aGlzLnByb2Nlc3NvcnMgPSBbXTtcblxuICAgICAgICAvLyBUaGUgbmV4dCB1bmlxdWUgaWRlbnRpZmllci5cbiAgICAgICAgdGhpcy51aWQgPSAwO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFJldHVybiBhbiBpZGVudGlmaWVyIHVuaXF1ZSB0byB0aGlzIHN5c3RlbS5cbiAgICAgKlxuICAgICAqIEByZXR1cm4ge2ludH0gLSBVbmlxdWUgaWRlbnRpZmllci5cbiAgICAgKi9cbiAgICBnZXRVaWQoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnVpZCsrO1xuICAgIH1cblxuICAgIC8vPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAgIC8vIEVOVElUSUVTXG5cbiAgICAvKipcbiAgICAgKiBDcmVhdGUgYSBuZXcgZW50aXR5IGluIHRoZSBzeXN0ZW0gYnkgY3JlYXRpbmcgYSBuZXcgaW5zdGFuY2Ugb2YgZWFjaCBvZlxuICAgICAqIGl0cyBjb21wb25lbnRzLlxuICAgICAqXG4gICAgICogQHBhcmFtIHthcnJheX0gY29tcG9uZW50SWRzIC0gTGlzdCBvZiBpZGVudGlmaWVycyBvZiB0aGUgY29tcG9uZW50cyB0aGF0IGNvbXBvc2UgdGhlIG5ldyBlbnRpdHkuXG4gICAgICogQHJldHVybiB7aW50fSAtIFVuaXF1ZSBpZGVudGlmaWVyIG9mIHRoZSBuZXcgZW50aXR5LlxuICAgICAqL1xuICAgIGNyZWF0ZUVudGl0eShjb21wb25lbnRJZHMpIHtcbiAgICAgICAgdmFyIGlkID0gdGhpcy5nZXRVaWQoKTtcbiAgICAgICAgdGhpcy5hZGRDb21wb25lbnRzVG9FbnRpdHkoY29tcG9uZW50SWRzLCBpZCk7XG4gICAgICAgIHRoaXMuZW50aXRpZXMucHVzaChpZCk7XG4gICAgICAgIHJldHVybiBpZDtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBSZW1vdmUgYW4gZW50aXR5IGFuZCBpdHMgaW5zdGFuY2lhdGVkIGNvbXBvbmVudHMgZnJvbSB0aGUgc3lzdGVtLlxuICAgICAqXG4gICAgICogQHBhcmFtIHtpbnR9IGlkIC0gVW5pcXVlIGlkZW50aWZpZXIgb2YgdGhlIGVudGl0eS5cbiAgICAgKiBAcmV0dXJuIHtvYmplY3R9IC0gdGhpc1xuICAgICAqL1xuICAgIHJlbW92ZUVudGl0eShpZCkge1xuICAgICAgICAvLyBSZW1vdmUgYWxsIGRhdGEgZm9yIHRoaXMgZW50aXR5LlxuICAgICAgICBmb3IgKHZhciBjb21wIGluIHRoaXMuZW50aXR5Q29tcG9uZW50RGF0YSkge1xuICAgICAgICAgICAgaWYgKHRoaXMuZW50aXR5Q29tcG9uZW50RGF0YS5oYXNPd25Qcm9wZXJ0eShjb21wKSkge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLmVudGl0eUNvbXBvbmVudERhdGFbY29tcF1baWRdKSB7XG4gICAgICAgICAgICAgICAgICAgIGRlbGV0ZSB0aGlzLmVudGl0eUNvbXBvbmVudERhdGFbY29tcF1baWRdO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIC8vIFJlbW92ZSB0aGUgZW50aXR5IGZyb20gdGhlIGxpc3Qgb2Yga25vd24gZW50aXRpZXMuXG4gICAgICAgIHRoaXMuZW50aXRpZXMuc3BsaWNlKHRoaXMuZW50aXRpZXMuaW5kZXhPZihpZCksIDEpO1xuXG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH1cblxuICAgIC8vPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAgIC8vIENPTVBPTkVOVFNcblxuICAgIC8qKlxuICAgICAqIEFkZCBhIGNvbXBvbmVudCB0byB0aGUgbGlzdCBvZiBrbm93biBjb21wb25lbnRzLlxuICAgICAqXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IGlkIC0gVW5pcXVlIGlkZW50aWZpZXIgb2YgdGhlIGNvbXBvbmVudC5cbiAgICAgKiBAcGFyYW0ge29iamVjdH0gY29tcG9uZW50IC0gT2JqZWN0IGNvbnRhaW5pbmcgdGhlIG1ldGFkYXRhIGFuZCBkYXRhIG9mIHRoZSBjb21wb25lbnQuXG4gICAgICogQHJldHVybiB7b2JqZWN0fSAtIHRoaXNcbiAgICAgKi9cbiAgICBhZGRDb21wb25lbnQoaWQsIGNvbXBvbmVudCkge1xuICAgICAgICB0aGlzLmNvbXBvbmVudHNbaWRdID0gY29tcG9uZW50O1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBSZW1vdmUgYSBjb21wb25lbnQgZnJvbSB0aGUgbGlzdCBvZiBrbm93biBjb21wb25lbnRzLlxuICAgICAqXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IGlkIC0gVW5pcXVlIGlkZW50aWZpZXIgb2YgdGhlIGNvbXBvbmVudC5cbiAgICAgKiBAcmV0dXJuIHtvYmplY3R9IC0gdGhpc1xuICAgICAqL1xuICAgIHJlbW92ZUNvbXBvbmVudChpZCkge1xuICAgICAgICBkZWxldGUgdGhpcy5jb21wb25lbnRzW2lkXTtcbiAgICAgICAgZGVsZXRlIHRoaXMuZW50aXR5Q29tcG9uZW50RGF0YVtpZF07XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEdldCB0aGUgbGlzdCBvZiBjb21wb25lbnRzIHRoaXMgaW5zdGFuY2Uga25vd3MuXG4gICAgICpcbiAgICAgKiBAcmV0dXJuIHthcnJheX0gLSBMaXN0IG9mIG5hbWVzIG9mIGNvbXBvbmVudHMuXG4gICAgICovXG4gICAgZ2V0Q29tcG9uZW50c0xpc3QoKSB7XG4gICAgICAgIHJldHVybiBPYmplY3Qua2V5cyh0aGlzLmNvbXBvbmVudHMpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENyZWF0ZSBhIG5ldyBpbnN0YW5jZSBvZiBlYWNoIGxpc3RlZCBjb21wb25lbnQgYW5kIGFzc29jaWF0ZSB0aGVtXG4gICAgICogd2l0aCB0aGUgZW50aXR5LlxuICAgICAqXG4gICAgICogQHBhcmFtIHthcnJheX0gY29tcG9uZW50SWRzIC0gTGlzdCBvZiBpZGVudGlmaWVycyBvZiB0aGUgY29tcG9uZW50cyB0byBhZGQgdG8gdGhlIGVudGl0eS5cbiAgICAgKiBAcGFyYW0ge2ludH0gZW50aXR5SWQgLSBVbmlxdWUgaWRlbnRpZmllciBvZiB0aGUgZW50aXR5LlxuICAgICAqIEByZXR1cm4ge29iamVjdH0gLSB0aGlzXG4gICAgICovXG4gICAgYWRkQ29tcG9uZW50c1RvRW50aXR5KGNvbXBvbmVudElkcywgZW50aXR5SWQpIHtcbiAgICAgICAgdmFyIGk7XG4gICAgICAgIHZhciBjb21wO1xuICAgICAgICB2YXIgc2VsZiA9IHRoaXM7XG5cbiAgICAgICAgLy8gRmlyc3QgdmVyaWZ5IHRoYXQgYWxsIHRoZSBjb21wb25lbnRzIGV4aXN0LCBhbmQgdGhyb3cgYW4gZXJyb3JcbiAgICAgICAgLy8gaWYgYW55IGlzIHVua25vd24uXG4gICAgICAgIGZvciAoaSA9IGNvbXBvbmVudElkcy5sZW5ndGggLSAxOyBpID49IDA7IGktLSkge1xuICAgICAgICAgICAgY29tcCA9IGNvbXBvbmVudElkc1tpXTtcblxuICAgICAgICAgICAgaWYgKCF0aGlzLmNvbXBvbmVudHNbY29tcF0pIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1RyeWluZyB0byB1c2UgdW5rbm93biBjb21wb25lbnQ6ICcgKyBjb21wKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIC8vIE5vdyB3ZSBrbm93IHRoYXQgdGhpcyByZXF1ZXN0IGlzIGNvcnJlY3QsIGxldCdzIGNyZWF0ZSB0aGUgbmV3XG4gICAgICAgIC8vIGVudGl0eSBhbmQgaW5zdGFuY2lhdGUgdGhlIGNvbXBvbmVudCdzIHN0YXRlcy5cbiAgICAgICAgZm9yIChpID0gY29tcG9uZW50SWRzLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKSB7XG4gICAgICAgICAgICBjb21wID0gY29tcG9uZW50SWRzW2ldO1xuXG4gICAgICAgICAgICBpZiAoIXRoaXMuZW50aXR5Q29tcG9uZW50RGF0YVtjb21wXSkge1xuICAgICAgICAgICAgICAgIHRoaXMuZW50aXR5Q29tcG9uZW50RGF0YVtjb21wXSA9IHt9O1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB2YXIgbmV3Q29tcFN0YXRlID0gbnVsbDtcblxuICAgICAgICAgICAgLy8gSWYgdGhlIG1hbmFnZXIgaGFzIGEgbGlzdGVuZXIsIHdlIHdhbnQgdG8gY3JlYXRlIGdldHRlcnNcbiAgICAgICAgICAgIC8vIGFuZCBzZXR0ZXJzIHNvIHRoYXQgd2UgY2FuIGVtaXQgc3RhdGUgY2hhbmdlcy4gQnV0IGlmIGl0IGRvZXNcbiAgICAgICAgICAgIC8vIG5vdCBoYXZlIG9uZSwgdGhlcmUgaXMgbm8gbmVlZCB0byBhZGQgdGhlIG92ZXJoZWFkLlxuICAgICAgICAgICAgaWYgKHNlbGYubGlzdGVuZXIpIHtcbiAgICAgICAgICAgICAgICBuZXdDb21wU3RhdGUgPSB7fTtcbiAgICAgICAgICAgICAgICAoZnVuY3Rpb24gKG5ld0NvbXBTdGF0ZSkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgc3RhdGUgPSBjbG9uZShzZWxmLmNvbXBvbmVudHNbY29tcF0uc3RhdGUpO1xuXG4gICAgICAgICAgICAgICAgICAgIC8vIENyZWF0ZSBhIHNldHRlciBmb3IgZWFjaCBzdGF0ZSBhdHRyaWJ1dGUsIHNvIHdlIGNhbiBlbWl0IGFuXG4gICAgICAgICAgICAgICAgICAgIC8vIGV2ZW50IHdoZW5ldmVyIHRoZSBzdGF0ZSBvZiB0aGlzIGNvbXBvbmVudCBjaGFuZ2VzLlxuICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBwcm9wZXJ0eSBpbiBzdGF0ZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHN0YXRlLmhhc093blByb3BlcnR5KHByb3BlcnR5KSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIChmdW5jdGlvbiAocHJvcGVydHkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG5ld0NvbXBTdGF0ZSwgcHJvcGVydHksIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdldDogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBzdGF0ZVtwcm9wZXJ0eV07XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2V0OiBmdW5jdGlvbiAodmFsKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhdGVbcHJvcGVydHldID0gdmFsO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYubGlzdGVuZXIuZW1pdCgnZW50aXR5Q29tcG9uZW50VXBkYXRlZCcsIGVudGl0eUlkLCBjb21wKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pKHByb3BlcnR5KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pKG5ld0NvbXBTdGF0ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBuZXdDb21wU3RhdGUgPSBjbG9uZShzZWxmLmNvbXBvbmVudHNbY29tcF0uc3RhdGUpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBTdG9yZSB0aGUgZW50aXR5J3MgSUQgc28gaXQncyBlYXNpZXIgdG8gZmluZCBvdGhlciBjb21wb25lbnRzIGZvciB0aGF0IGVudGl0eS5cbiAgICAgICAgICAgIG5ld0NvbXBTdGF0ZS5fX2lkID0gZW50aXR5SWQ7XG5cbiAgICAgICAgICAgIHRoaXMuZW50aXR5Q29tcG9uZW50RGF0YVtjb21wXVtlbnRpdHlJZF0gPSBuZXdDb21wU3RhdGU7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBEZS1hc3NvY2lhdGUgYSBsaXN0IG9mIGNvbXBvbmVudHMgZnJvbSB0aGUgZW50aXR5LlxuICAgICAqXG4gICAgICogQHBhcmFtIHthcnJheX0gY29tcG9uZW50SWRzIC0gTGlzdCBvZiBpZGVudGlmaWVycyBvZiB0aGUgY29tcG9uZW50cyB0byByZW1vdmUgZnJvbSB0aGUgZW50aXR5LlxuICAgICAqIEBwYXJhbSB7aW50fSBlbnRpdHlJZCAtIFVuaXF1ZSBpZGVudGlmaWVyIG9mIHRoZSBlbnRpdHkuXG4gICAgICogQHJldHVybiB7b2JqZWN0fSAtIHRoaXNcbiAgICAgKi9cbiAgICByZW1vdmVDb21wb25lbnRzRnJvbUVudGl0eShjb21wb25lbnRJZHMsIGVudGl0eUlkKSB7XG4gICAgICAgIHZhciBpO1xuICAgICAgICB2YXIgY29tcDtcblxuICAgICAgICAvLyBGaXJzdCB2ZXJpZnkgdGhhdCBhbGwgdGhlIGNvbXBvbmVudHMgZXhpc3QsIGFuZCB0aHJvdyBhbiBlcnJvclxuICAgICAgICAvLyBpZiBhbnkgaXMgdW5rbm93bi5cbiAgICAgICAgZm9yIChpID0gY29tcG9uZW50SWRzLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKSB7XG4gICAgICAgICAgICBjb21wID0gY29tcG9uZW50SWRzW2ldO1xuXG4gICAgICAgICAgICBpZiAoIXRoaXMuY29tcG9uZW50c1tjb21wXSkge1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignVHJ5aW5nIHRvIHVzZSB1bmtub3duIGNvbXBvbmVudDogJyArIGNvbXApO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgLy8gTm93IHdlIGtub3cgdGhhdCB0aGlzIHJlcXVlc3QgaXMgY29ycmVjdCwgbGV0J3MgY3JlYXRlIHRoZSBuZXdcbiAgICAgICAgLy8gZW50aXR5IGFuZCBpbnN0YW5jaWF0ZSB0aGUgY29tcG9uZW50J3Mgc3RhdGVzLlxuICAgICAgICBmb3IgKGkgPSBjb21wb25lbnRJZHMubGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0pIHtcbiAgICAgICAgICAgIGNvbXAgPSBjb21wb25lbnRJZHNbaV07XG5cbiAgICAgICAgICAgIGlmICh0aGlzLmVudGl0eUNvbXBvbmVudERhdGFbY29tcF0pIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5lbnRpdHlDb21wb25lbnREYXRhW2NvbXBdW2VudGl0eUlkXSkge1xuICAgICAgICAgICAgICAgICAgICBkZWxldGUgdGhpcy5lbnRpdHlDb21wb25lbnREYXRhW2NvbXBdW2VudGl0eUlkXTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuXG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFJldHVybiBhIHJlZmVyZW5jZSB0byBhbiBvYmplY3QgdGhhdCBjb250YWlucyB0aGUgZGF0YSBvZiBhblxuICAgICAqIGluc3RhbmNpYXRlZCBjb21wb25lbnQgb2YgYW4gZW50aXR5LlxuICAgICAqXG4gICAgICogQHBhcmFtIHtpbnR9IGVudGl0eUlkIC0gVW5pcXVlIGlkZW50aWZpZXIgb2YgdGhlIGVudGl0eS5cbiAgICAgKiBAcGFyYW0ge3N0cmluZ30gY29tcG9uZW50SWQgLSBVbmlxdWUgaWRlbnRpZmllciBvZiB0aGUgY29tcG9uZW50LlxuICAgICAqIEByZXR1cm4ge29iamVjdH0gLSBDb21wb25lbnQgZGF0YSBvZiBvbmUgZW50aXR5LlxuICAgICAqL1xuICAgIGdldENvbXBvbmVudERhdGFGb3JFbnRpdHkoY29tcG9uZW50SWQsIGVudGl0eUlkKSB7XG4gICAgICAgIGlmICghKGNvbXBvbmVudElkIGluIHRoaXMuY29tcG9uZW50cykpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignVHJ5aW5nIHRvIHVzZSB1bmtub3duIGNvbXBvbmVudDogJyArIGNvbXBvbmVudElkKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChcbiAgICAgICAgICAgICF0aGlzLmVudGl0eUNvbXBvbmVudERhdGEuaGFzT3duUHJvcGVydHkoY29tcG9uZW50SWQpIHx8XG4gICAgICAgICAgICAhdGhpcy5lbnRpdHlDb21wb25lbnREYXRhW2NvbXBvbmVudElkXS5oYXNPd25Qcm9wZXJ0eShlbnRpdHlJZClcbiAgICAgICAgKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ05vIGRhdGEgZm9yIGNvbXBvbmVudCAnICsgY29tcG9uZW50SWQgKyAnIGFuZCBlbnRpdHkgJyArIGVudGl0eUlkKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiB0aGlzLmVudGl0eUNvbXBvbmVudERhdGFbY29tcG9uZW50SWRdW2VudGl0eUlkXTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBVcGRhdGUgdGhlIHN0YXRlIG9mIGEgY29tcG9uZW50LCBtYW55IGtleXMgYXQgb25jZS5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB7aW50fSBlbnRpdHlJZCAtIFVuaXF1ZSBpZGVudGlmaWVyIG9mIHRoZSBlbnRpdHkuXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IGNvbXBvbmVudElkIC0gVW5pcXVlIGlkZW50aWZpZXIgb2YgdGhlIGNvbXBvbmVudC5cbiAgICAgKiBAcGFyYW0ge29iamVjdH0gbmV3U3RhdGUgLSBPYmplY3QgY29udGFpbmluZyB0aGUgbmV3IHN0YXRlIHRvIGFwcGx5LlxuICAgICAqIEByZXR1cm4ge29iamVjdH0gLSB0aGlzXG4gICAgICovXG4gICAgdXBkYXRlQ29tcG9uZW50RGF0YUZvckVudGl0eShjb21wb25lbnRJZCwgZW50aXR5SWQsIG5ld1N0YXRlKSB7XG4gICAgICAgIHZhciBjb21wU3RhdGUgPSB0aGlzLmdldENvbXBvbmVudERhdGFGb3JFbnRpdHkoY29tcG9uZW50SWQsIGVudGl0eUlkKTtcblxuICAgICAgICBmb3IgKHZhciBrZXkgaW4gbmV3U3RhdGUpIHtcbiAgICAgICAgICAgIGlmIChuZXdTdGF0ZS5oYXNPd25Qcm9wZXJ0eShrZXkpICYmIGNvbXBTdGF0ZS5oYXNPd25Qcm9wZXJ0eShrZXkpKSB7XG4gICAgICAgICAgICAgICAgY29tcFN0YXRlW2tleV0gPSBuZXdTdGF0ZVtrZXldO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogUmV0dXJuIGEgbGlzdCBvZiBvYmplY3RzIGNvbnRhaW5pbmcgdGhlIGRhdGEgb2YgYWxsIG9mIGEgZ2l2ZW4gY29tcG9uZW50LlxuICAgICAqXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IGNvbXBvbmVudElkIC0gVW5pcXVlIGlkZW50aWZpZXIgb2YgdGhlIGNvbXBvbmVudC5cbiAgICAgKiBAcmV0dXJuIHthcnJheX0gLSBMaXN0IG9mIGNvbXBvbmVudCBkYXRhIGZvciBvbmUgY29tcG9uZW50LlxuICAgICAqL1xuICAgIGdldENvbXBvbmVudHNEYXRhKGNvbXBvbmVudElkKSB7XG4gICAgICAgIGlmICghKGNvbXBvbmVudElkIGluIHRoaXMuY29tcG9uZW50cykpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignVHJ5aW5nIHRvIHVzZSB1bmtub3duIGNvbXBvbmVudDogJyArIGNvbXBvbmVudElkKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICghdGhpcy5lbnRpdHlDb21wb25lbnREYXRhLmhhc093blByb3BlcnR5KGNvbXBvbmVudElkKSkge1xuICAgICAgICAgICAgcmV0dXJuIFtdO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHRoaXMuZW50aXR5Q29tcG9uZW50RGF0YVtjb21wb25lbnRJZF07XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogUmV0dXJuIHRydWUgaWYgdGhlIGVudGl0eSBoYXMgdGhlIGNvbXBvbmVudC5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB7aW50fSBlbnRpdHlJZCAtIFVuaXF1ZSBpZGVudGlmaWVyIG9mIHRoZSBlbnRpdHkuXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IGNvbXBvbmVudElkIC0gVW5pcXVlIGlkZW50aWZpZXIgb2YgdGhlIGNvbXBvbmVudC5cbiAgICAgKiBAcmV0dXJuIHtib29sZWFufSAtIFRydWUgaWYgdGhlIGVudGl0eSBoYXMgdGhlIGNvbXBvbmVudC5cbiAgICAgKi9cbiAgICBlbnRpdHlIYXNDb21wb25lbnQoZW50aXR5SWQsIGNvbXBvbmVudElkKSB7XG4gICAgICAgIGlmICghKGNvbXBvbmVudElkIGluIHRoaXMuY29tcG9uZW50cykpIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiAoXG4gICAgICAgICAgICB0aGlzLmVudGl0eUNvbXBvbmVudERhdGEuaGFzT3duUHJvcGVydHkoY29tcG9uZW50SWQpICYmXG4gICAgICAgICAgICB0aGlzLmVudGl0eUNvbXBvbmVudERhdGFbY29tcG9uZW50SWRdLmhhc093blByb3BlcnR5KGVudGl0eUlkKVxuICAgICAgICApO1xuICAgIH1cblxuICAgIC8vPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAgIC8vIEFTU0VNQkxBR0VTXG5cbiAgICAvKipcbiAgICAgKiBBZGQgYW4gYXNzZW1ibGFnZSB0byB0aGUgbGlzdCBvZiBrbm93biBhc3NlbWJsYWdlcy5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSBpZCAtIFVuaXF1ZSBpZGVudGlmaWVyIG9mIHRoZSBhc3NlbWJsYWdlLlxuICAgICAqIEBwYXJhbSB7b2JqZWN0fSBhc3NlbWJsYWdlIC0gQW4gaW5zdGFuY2Ugb2YgYW4gYXNzZW1ibGFnZSB0byBhZGQuXG4gICAgICogQHJldHVybiB7b2JqZWN0fSAtIHRoaXNcbiAgICAgKi9cbiAgICBhZGRBc3NlbWJsYWdlKGlkLCBhc3NlbWJsYWdlKSB7XG4gICAgICAgIHRoaXMuYXNzZW1ibGFnZXNbaWRdID0gYXNzZW1ibGFnZTtcbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogUmVtb3ZlIGFuIGFzc2VtYmxhZ2UgZnJvbSB0aGUgbGlzdCBvZiBrbm93biBhc3NlbWJsYWdlcy5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSBpZCAtIFVuaXF1ZSBpZGVudGlmaWVyIG9mIHRoZSBhc3NlbWJsYWdlLlxuICAgICAqIEByZXR1cm4ge29iamVjdH0gLSB0aGlzXG4gICAgICovXG4gICAgcmVtb3ZlQXNzZW1ibGFnZShpZCkge1xuICAgICAgICBkZWxldGUgdGhpcy5hc3NlbWJsYWdlc1tpZF07XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENyZWF0ZSBhIG5ldyBlbnRpdHkgaW4gdGhlIHN5c3RlbSBieSBjcmVhdGluZyBhIG5ldyBpbnN0YW5jZSBvZiBlYWNoIG9mXG4gICAgICogaXRzIGNvbXBvbmVudHMgYW5kIHNldHRpbmcgdGhlaXIgaW5pdGlhbCBzdGF0ZSwgdXNpbmcgYW4gYXNzZW1ibGFnZS5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSBhc3NlbWJsYWdlSWQgLSBJZCBvZiB0aGUgYXNzZW1ibGFnZSB0byBjcmVhdGUgdGhlIGVudGl0eSBmcm9tLlxuICAgICAqIEByZXR1cm4ge2ludH0gLSBVbmlxdWUgaWRlbnRpZmllciBvZiB0aGUgbmV3IGVudGl0eS5cbiAgICAgKi9cbiAgICBjcmVhdGVFbnRpdHlGcm9tQXNzZW1ibGFnZShhc3NlbWJsYWdlSWQpIHtcbiAgICAgICAgaWYgKCEoYXNzZW1ibGFnZUlkIGluIHRoaXMuYXNzZW1ibGFnZXMpKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1RyeWluZyB0byB1c2UgdW5rbm93biBhc3NlbWJsYWdlOiAnICsgYXNzZW1ibGFnZUlkKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHZhciBhc3NlbWJsYWdlID0gdGhpcy5hc3NlbWJsYWdlc1thc3NlbWJsYWdlSWRdO1xuICAgICAgICB2YXIgZW50aXR5ID0gdGhpcy5jcmVhdGVFbnRpdHkoYXNzZW1ibGFnZS5jb21wb25lbnRzKTtcblxuICAgICAgICBmb3IgKHZhciBjb21wIGluIGFzc2VtYmxhZ2UuaW5pdGlhbFN0YXRlKSB7XG4gICAgICAgICAgICBpZiAoYXNzZW1ibGFnZS5pbml0aWFsU3RhdGUuaGFzT3duUHJvcGVydHkoY29tcCkpIHtcbiAgICAgICAgICAgICAgICB2YXIgbmV3U3RhdGUgPSBhc3NlbWJsYWdlLmluaXRpYWxTdGF0ZVtjb21wXTtcbiAgICAgICAgICAgICAgICB0aGlzLnVwZGF0ZUNvbXBvbmVudERhdGFGb3JFbnRpdHkoY29tcCwgZW50aXR5LCBuZXdTdGF0ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gZW50aXR5O1xuICAgIH1cblxuICAgIC8vPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAgIC8vIFBST0NFU1NPUlNcblxuICAgIC8qKlxuICAgICAqIEFkZCBhIHByb2Nlc3NvciB0byB0aGUgbGlzdCBvZiBrbm93biBwcm9jZXNzb3JzLlxuICAgICAqXG4gICAgICogQHBhcmFtIHtvYmplY3R9IHByb2Nlc3NvciAtIEFuIGluc3RhbmNlIG9mIGEgcHJvY2Vzc29yIHRvIG1hbmFnZS5cbiAgICAgKiBAcmV0dXJuIHtvYmplY3R9IC0gdGhpc1xuICAgICAqL1xuICAgIGFkZFByb2Nlc3Nvcihwcm9jZXNzb3IpIHtcbiAgICAgICAgdGhpcy5wcm9jZXNzb3JzLnB1c2gocHJvY2Vzc29yKTtcbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogUmVtb3ZlIGEgcHJvY2Vzc29yIGZyb20gdGhlIGxpc3Qgb2Yga25vd24gcHJvY2Vzc29ycy5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB7b2JqZWN0fSBwcm9jZXNzb3IgLSBBbiBpbnN0YW5jZSBvZiBhIHByb2Nlc3NvciB0byByZW1vdmUuXG4gICAgICogQHJldHVybiB7b2JqZWN0fSAtIHRoaXNcbiAgICAgKi9cbiAgICByZW1vdmVQcm9jZXNzb3IocHJvY2Vzc29yKSB7XG4gICAgICAgIHRoaXMucHJvY2Vzc29ycy5zcGxpY2UodGhpcy5wcm9jZXNzb3JzLmluZGV4T2YocHJvY2Vzc29yKSwgMSk7XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFVwZGF0ZSBhbGwgdGhlIGtub3duIHByb2Nlc3NvcnMuXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge2ludH0gZHQgLSBUaGUgdGltZSBkZWx0YSBzaW5jZSB0aGUgbGFzdCBjYWxsIHRvIHVwZGF0ZS4gV2lsbCBiZSBwYXNzZWQgYXMgYW4gYXJndW1lbnQgdG8gYWxsIHByb2Nlc3NvcidzIGB1cGRhdGVgIG1ldGhvZC5cbiAgICAgKiBAcmV0dXJuIHtvYmplY3R9IC0gdGhpc1xuICAgICAqL1xuICAgIHVwZGF0ZShkdCkge1xuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMucHJvY2Vzc29ycy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgdGhpcy5wcm9jZXNzb3JzW2ldLnVwZGF0ZShkdCk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBFbnRpdHlNYW5hZ2VyO1xuIl0sIm5hbWVzIjpbImNsb25lIiwib2JqIiwiY29weSIsIkRhdGUiLCJzZXRUaW1lIiwiZ2V0VGltZSIsIkFycmF5IiwiaSIsImxlbiIsImxlbmd0aCIsIk9iamVjdCIsImF0dHIiLCJoYXNPd25Qcm9wZXJ0eSIsImlzRnVuY3Rpb24iLCJ0aGluZ1RvQ2hlY2siLCJ0b1N0cmluZyIsImNhbGwiLCJFbnRpdHlNYW5hZ2VyIiwibGlzdGVuZXIiLCJlbWl0IiwiZW50aXRpZXMiLCJjb21wb25lbnRzIiwiYXNzZW1ibGFnZXMiLCJlbnRpdHlDb21wb25lbnREYXRhIiwicHJvY2Vzc29ycyIsInVpZCIsInRoaXMiLCJjb21wb25lbnRJZHMiLCJpZCIsImdldFVpZCIsImFkZENvbXBvbmVudHNUb0VudGl0eSIsInB1c2giLCJjb21wIiwic3BsaWNlIiwiaW5kZXhPZiIsImNvbXBvbmVudCIsImtleXMiLCJlbnRpdHlJZCIsInNlbGYiLCJFcnJvciIsIm5ld0NvbXBTdGF0ZSIsInN0YXRlIiwicHJvcGVydHkiLCJkZWZpbmVQcm9wZXJ0eSIsInZhbCIsIl9faWQiLCJjb21wb25lbnRJZCIsIm5ld1N0YXRlIiwiY29tcFN0YXRlIiwiZ2V0Q29tcG9uZW50RGF0YUZvckVudGl0eSIsImtleSIsImFzc2VtYmxhZ2UiLCJhc3NlbWJsYWdlSWQiLCJlbnRpdHkiLCJjcmVhdGVFbnRpdHkiLCJpbml0aWFsU3RhdGUiLCJ1cGRhdGVDb21wb25lbnREYXRhRm9yRW50aXR5IiwicHJvY2Vzc29yIiwiZHQiLCJ1cGRhdGUiXSwibWFwcGluZ3MiOiIrS0FlQSxTQUFTQSxHQUFNQyxNQUVQLE1BQVFBLEdBQU8sOEJBQW1CQSxpQkFBQUEsSUFBSyxNQUFPQSxNQUU5Q0MsTUFHQUQsWUFBZUUsZUFDUixHQUFJQSxRQUNOQyxRQUFRSCxFQUFJSSxXQUNWSCxLQUlQRCxZQUFlSyxPQUFPLFVBRWpCLEdBQUlDLEdBQUksRUFBR0MsRUFBTVAsRUFBSVEsT0FBUUYsRUFBSUMsRUFBS0QsTUFDbENBLEdBQUtQLEVBQU1DLEVBQUlNLFVBRWpCTCxNQUlQRCxZQUFlUyxRQUFRLFVBRWxCLEdBQUlDLEtBQVFWLEdBQ1RBLEVBQUlXLGVBQWVELEtBQU9ULEVBQUtTLEdBQVFYLEVBQU1DLEVBQUlVLFdBRWxEVCxJQVFmLFFBQVNXLEdBQVdDLFNBQ1RBLElBQXFELHlCQUFoQ0MsU0FBU0MsS0FBS0YsNGpEQVN4Q0csd0JBQ1VDLGtCQUNIQSxTQUFXLEtBQ1pBLEdBQVlMLEVBQVdLLEVB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
